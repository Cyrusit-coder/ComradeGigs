{% extends "base.html" %}
{% load static %}
{% load socialaccount %} {# Required for Google Login #}

{% block title %}Login | ComradeGigs{% endblock %}

{% block content %}
<div class="container-fluid p-0">
  <div class="row g-0" style="min-height: 85vh;">
    
    <div class="col-lg-6 d-none d-lg-block position-relative bg-dark">
      <img src="{% static 'images/welcomeback.jpg' %}" class="w-100 h-100 object-fit-cover opacity-50" alt="Students">
      <div class="position-absolute top-50 start-50 translate-middle text-center w-75">
        <h2 class="display-5 fw-bold text-white mb-3">Welcome Back, Comrade.</h2>
        <p class="lead text-white-50">Your skills are needed. Log in to check your gigs, update your profile, and keep the hustle moving.</p>
      </div>
    </div>

    <div class="col-lg-6 d-flex align-items-center justify-content-center bg-body">
      <div class="w-100 p-5" style="max-width: 550px;">
        
        <div class="text-center mb-5">
          <div class="d-inline-flex align-items-center justify-content-center bg-primary bg-opacity-10 text-primary rounded-circle mb-3" style="width: 60px; height: 60px;">
            <i class="bi bi-person-circle fs-2"></i>
          </div>
          <h3 class="fw-bold">Member Login</h3>
          <p class="text-secondary small">Enter your credentials to access your dashboard.</p>
        </div>

        <form method="post" class="needs-validation">
          {% csrf_token %}
          
          {% if form.non_field_errors %}
            <div class="alert alert-danger d-flex align-items-center mb-4 rounded-3 shadow-sm" role="alert">
              <i class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2"></i>
              <div>
                {% for error in form.non_field_errors %}
                  {{ error }}
                {% endfor %}
              </div>
            </div>
          {% endif %}

          {% for field in form %}
          <div class="mb-4">
            <div class="d-flex justify-content-between align-items-center">
                <label class="form-label fw-bold small text-uppercase text-secondary">{{ field.label }}</label>
            </div>

            <div class="input-group">
              <span class="input-group-text bg-light border-end-0 text-muted">
                  {% if field.field.widget.input_type == 'password' %}
                    <i class="bi bi-lock"></i>
                  {% else %}
                    <i class="bi bi-person"></i>
                  {% endif %}
              </span>
              
              <input type="{{ field.field.widget.input_type }}" 
                     name="{{ field.name }}" 
                     id="{{ field.id_for_label }}" 
                     class="form-control bg-light border-start-0 py-2 {% if field.field.widget.input_type == 'password' %}border-end-0{% endif %}" 
                     placeholder="Enter {{ field.label }}"
                     required>

              {% if field.field.widget.input_type == 'password' %}
                <span class="input-group-text bg-light border-start-0 text-muted" style="cursor: pointer;" onclick="togglePassword('{{ field.id_for_label }}', this)">
                    <i class="bi bi-eye"></i>
                </span>
              {% endif %}
            </div>

            {% if field.errors %}
              <div class="text-danger small mt-1">
                {% for error in field.errors %}
                  {{ error }}
                {% endfor %}
              </div>
            {% endif %}

            {% if field.field.widget.input_type == 'password' %}
            <div class="d-flex justify-content-end mt-2">
                <a href="{% url 'password_reset' %}" class="small text-decoration-none fw-bold text-primary">
                    Forgot Password?
                </a>
            </div>
            {% endif %}
          </div>
          {% endfor %}

          <div class="d-grid mt-4">
            <button type="submit" class="btn btn-primary btn-lg rounded-pill fw-bold shadow-sm hover-lift">
              Login to Dashboard <i class="bi bi-arrow-right ms-2"></i>
            </button>
          </div>
        </form>

        <div class="text-center mt-4">
            <div class="d-flex align-items-center mb-3">
                <hr class="flex-grow-1 opacity-25">
                <span class="px-3 text-muted small">Or continue with</span>
                <hr class="flex-grow-1 opacity-25">
            </div>
            
            <a href="{% provider_login_url 'google' %}" class="btn btn-white border shadow-sm rounded-pill px-4 fw-bold d-inline-flex align-items-center justify-content-center bg-white hover-lift w-100">
                <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg" alt="Google" width="20" class="me-3">
                Sign in with Google
            </a>
        </div>

        <div class="text-center mt-4">
          <p class="small text-secondary">
            New here? <a href="{% url 'myapp:register_landing' %}" class="text-decoration-none fw-bold text-primary">Create an Account</a>
          </p>
        </div>

      </div>
    </div>

  </div>
</div>

<script>
    function togglePassword(fieldId, iconContainer) {
        const inputField = document.getElementById(fieldId);
        const icon = iconContainer.querySelector('i');

        if (inputField.type === "password") {
            inputField.type = "text";
            icon.classList.remove("bi-eye");
            icon.classList.add("bi-eye-slash");
        } else {
            inputField.type = "password";
            icon.classList.remove("bi-eye-slash");
            icon.classList.add("bi-eye");
        }
    }
</script>

{% endblock %}